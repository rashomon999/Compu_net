<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat COMPU_NET - ICE + WebSocket</title>
  
  <!-- âœ… Ice.js DEBE cargarse ANTES que bundle.js -->
  <!-- Usar versiÃ³n especÃ­fica y verificar carga -->
  <script>
    // Verificar que Ice.js se carga correctamente
    window._iceLoadPromise = new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/ice/3.7.100/Ice.min.js';
      script.onload = () => {
        console.log('âœ… Ice.js cargado desde CDN');
        if (typeof Ice !== 'undefined') {
          window.Ice = Ice;
          resolve(Ice);
        } else {
          reject(new Error('Ice.js se cargÃ³ pero no estÃ¡ disponible'));
        }
      };
      script.onerror = () => {
        reject(new Error('No se pudo cargar Ice.js desde CDN'));
      };
      document.head.appendChild(script);
    });
  </script>
</head>
<body>
  
  <!-- PANTALLA DE LOGIN -->
  <div id="loginContainer" class="login-container">
    <div class="login-box">
      <h1>ğŸŒ Chat COMPU_NET</h1>
      <p class="subtitle">Sistema de mensajerÃ­a con ZeroC Ice</p>
      
      <div class="section">
        <input 
          type="text" 
          id="usernameInput" 
          placeholder="Ingresa tu nombre de usuario"
          autocomplete="off"
        >
        <button id="loginButton">Conectar</button>
      </div>
      
      <div class="tech-info">
        <small>ğŸ”— WebSocket ICE | ğŸ¤ Notas de voz | âš¡ Tiempo real</small>
      </div>
    </div>
  </div>

  <!-- PANTALLA DE CHAT -->
  <div id="chatContainer" class="chat-container hidden">
    
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="user-info">
        <div class="user-avatar">ğŸ‘¤</div>
        <strong id="currentUsername"></strong>
        <button id="logoutButton" class="logout-btn">Salir</button>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="chats">ğŸ’¬ Chats</button>
        <button class="tab" data-tab="grupos">ğŸ‘¥ Grupos</button>
      </div>

      <!-- TAB: CHATS -->
      <div id="chatsTab" class="tab-content active">
        <div class="section">
          <h3>Nuevo chat</h3>
          <div class="input-group">
            <input type="text" id="newChatUser" placeholder="Nombre de usuario">
            <button id="openChatButton">Abrir</button>
          </div>
        </div>
        
        <p class="section-title">Conversaciones</p>
        <div id="chatsList" class="conversations">
          <p class="empty-state">No hay conversaciones</p>
        </div>
      </div>

      <!-- TAB: GRUPOS -->
      <div id="gruposTab" class="tab-content">
        <div class="section">
          <h3>Crear grupo</h3>
          <div class="input-group">
            <input type="text" id="newGroupName" placeholder="Nombre del grupo">
            <button id="createGroupButton">Crear</button>
          </div>
        </div>

        <div class="section">
          <h3>Unirse a grupo</h3>
          <div class="input-group">
            <input type="text" id="joinGroupName" placeholder="Nombre del grupo">
            <button id="joinGroupButton">Unirse</button>
          </div>
        </div>

        <p class="section-title">Mis grupos</p>
        <div id="groupsList" class="conversations">
          <p class="empty-state">No estÃ¡s en ningÃºn grupo</p>
        </div>
      </div>
    </div>

    <!-- ÃREA PRINCIPAL -->
    <div class="main-content">
      <div id="chatHeader" class="chat-header">
        <div class="chat-info">
          <h2>Bienvenido ğŸ‘‹</h2>
          <p>Selecciona un chat o crea uno nuevo</p>
        </div>
      </div>

      <div id="messagesContainer" class="messages-container">
        <div class="welcome-message">
          <h3>ğŸ‰ Comienza a chatear</h3>
          <p>Selecciona una conversaciÃ³n del sidebar o inicia una nueva</p>
          <ul>
            <li>ğŸ’¬ Mensajes de texto en tiempo real</li>
            <li>ğŸ¤ Notas de voz (hasta 30 segundos)</li>
            <li>ğŸ‘¥ Grupos de chat</li>
            <li>ğŸ”” Notificaciones push automÃ¡ticas</li>
          </ul>
        </div>
      </div>

      <!-- ğŸ†• CONTROLES DE AUDIO -->
      <div id="audioControls" class="audio-controls hidden">
        <div id="voiceNoteControls" class="voice-controls">
          <button id="recordButton" class="btn-audio">
            ğŸ¤ Grabar nota de voz
          </button>
          <span id="recordingTimer" class="timer hidden">0:00</span>
          <button id="cancelButton" class="btn-secondary btn-small hidden">
            Cancelar
          </button>
        </div>
      </div>

      <!-- ENTRADA DE MENSAJES -->
      <div id="messageInputContainer" class="message-input hidden">
        <div class="input-wrapper">
          <textarea 
            id="messageText" 
            placeholder="Escribe un mensaje..."
            rows="2"
          ></textarea>
          <div class="action-buttons">
            <button id="sendMessageButton" class="btn-send">Enviar</button>
            <button id="toggleAudioButton" class="btn-audio-menu" title="Nota de voz">
              ğŸ¤
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Webpack inyectarÃ¡ automÃ¡ticamente bundle.js aquÃ­ -->
</body>
</html>